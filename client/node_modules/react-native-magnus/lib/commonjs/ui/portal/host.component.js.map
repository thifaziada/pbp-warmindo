{"version":3,"names":["Context","React","createContext","Host","children","style","managerRef","useRef","queue","generateKey","removeKey","useKey","useEffect","length","current","action","pop","type","mount","key","update","unmount","push","op","index","findIndex","o","flex"],"sources":["host.component.tsx"],"sourcesContent":["import * as React from 'react';\nimport { View, ViewStyle } from 'react-native';\n\nimport { useKey } from './hooks/useKey';\nimport { Manager, IManagerHandles } from './manager.component';\n\ninterface IHostProps {\n  children: React.ReactNode;\n  style?: ViewStyle;\n}\n\nexport interface IProvider {\n  mount(children: React.ReactNode): string;\n  update(key?: string, children?: React.ReactNode): void;\n  unmount(key?: string): void;\n}\n\nexport const Context = React.createContext<IProvider | null>(null);\n\nexport const Host = ({ children, style }: IHostProps): JSX.Element => {\n  const managerRef = React.useRef<IManagerHandles>(null);\n  const queue: {\n    type: 'mount' | 'update' | 'unmount';\n    key: string;\n    children?: React.ReactNode;\n  }[] = [];\n  const { generateKey, removeKey } = useKey();\n\n  React.useEffect(() => {\n    while (queue.length && managerRef.current) {\n      const action = queue.pop();\n\n      if (action) {\n        switch (action.type) {\n          case 'mount':\n            managerRef.current?.mount(action.key, action.children);\n            break;\n          case 'update':\n            managerRef.current?.update(action.key, action.children);\n            break;\n          case 'unmount':\n            managerRef.current?.unmount(action.key);\n            break;\n        }\n      }\n    }\n  }, []);\n\n  const mount = (children: React.ReactNode): string => {\n    const key = generateKey();\n\n    if (managerRef.current) {\n      managerRef.current.mount(key, children);\n    } else {\n      queue.push({ type: 'mount', key, children });\n    }\n\n    return key;\n  };\n\n  const update = (key: string, children: React.ReactNode): void => {\n    if (managerRef.current) {\n      managerRef.current.update(key, children);\n    } else {\n      const op = { type: 'mount' as 'mount', key, children };\n      const index = queue.findIndex(\n        (o) => o.type === 'mount' || (o.type === 'update' && o.key === key)\n      );\n\n      if (index > -1) {\n        queue[index] = op;\n      } else {\n        queue.push(op);\n      }\n    }\n  };\n\n  const unmount = (key: string): void => {\n    if (managerRef.current) {\n      managerRef.current.unmount(key);\n      removeKey(key);\n    } else {\n      queue.push({ type: 'unmount', key });\n    }\n  };\n\n  return (\n    <Context.Provider value={{ mount, update, unmount }}>\n      <View\n        style={[{ flex: 1 }, style]}\n        collapsable={false}\n        pointerEvents=\"box-none\"\n      >\n        {children}\n      </View>\n\n      <Manager ref={managerRef} />\n    </Context.Provider>\n  );\n};\n"],"mappings":"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"}